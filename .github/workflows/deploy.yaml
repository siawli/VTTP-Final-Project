name: Deploy to heroku
on:
  push:
    branches:
    - 'main'
    # have to change back to 'release' branch before final submission

jobs:
  # build_Angular_and_transfer_DIST_files_to_Server:
  #   name: Build Angular and files to Server
  #   runs-on: ubuntu-latest
  #   defaults:
  #     run:
  #       working-directory: 'FPAngular'
  #   steps:
  #   - name: Checkout Angular code
  #     uses: actions/checkout@v2
  #   - name: Setup node-version
  #     uses: actions/setup-node@v2
  #     with:
  #       node-version: '16.x'
  #   - name: NPM Install & Build
  #     run: |
  #          npm install --legacy-peer-deps
  #          npm install -g --legacy-peer-deps @angular/cli > /dev/null
  #          npm run build
  #   - name: Remove existing DIST files in server (if any)
  #     run: rm -rf ../FPServer/src/main/resources/static/*
  #   - name: Copying files to server
  #     run : cp -r './dist/fpangular/' '../FPServer/src/main/resources/static'
      
  build_Server_and_deploy:
    name: Build server and deploy
    # needs: build_Angular_and_transfer_DIST_files_to_Server
    runs-on: ubuntu-latest
    # defaults:
    #   run:
    #     working-directory: 'FPServer'
    steps:
    - name: Checkout src
      uses: actions/checkout@v2
    - name: Deploy
      uses: akhileshns/heroku-deploy@v3.12.12
      with: 
        heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
        heroku_app_name: "warm-basin-53580"
        heroku_email: ${{ secrets.email }}
        branch: ${{ github.ref_name }}
        appdir: 'FPServer'
